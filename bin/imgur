#!/bin/sh -e

APIKEY="428129b561549b21260028c01aa8b91a"

if [ ! -f "$1" ]; then
    echo "usage: $(basename $0) <filename>" >&2
    exit 1
fi

XML=$(curl -s -F "key=$APIKEY" -F "image=@$1" http://api.imgur.com/2/upload.xml)
URL=$(echo $XML | sed -E 's/.*<original>(.*)<\/original>.*/\1/' | sed 's/imgur/i.imgur/')
URL=$(curl -s -I $URL | grep Location | sed -E 's/Location: (.+)/\1/')
echo $URL | pbcopy
echo $URL
